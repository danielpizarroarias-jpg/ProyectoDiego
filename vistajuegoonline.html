<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroids Online - Neon Evolution</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
            color: #00ecff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas {
            display: block;
            box-shadow: 0 0 20px #00ecff;
            border: 2px solid #00ecff;
        }
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="ui-layer">
        <h2 id="status">CONECTANDO AL SERVIDOR...</h2>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth * 0.9;
        canvas.height = window.innerHeight * 0.8;

        const statusText = document.getElementById("status");
        const socket = io(); 

        let otherPlayers = {};
        let myShip = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            rotation: 0,
            color: "#00ecff"
        };

        socket.on('connect', () => {
            statusText.innerText = "SALA ONLINE ACTIVA";
            statusText.style.color = "#00ff41";
        });

        socket.on('currentPlayers', (players) => {
            otherPlayers = players;
        });

        socket.on('newPlayer', (playerInfo) => {
            otherPlayers[playerInfo.id] = playerInfo;
        });

        socket.on('playerMoved', (playerInfo) => {
            if (otherPlayers[playerInfo.id]) {
                otherPlayers[playerInfo.id].x = playerInfo.x;
                otherPlayers[playerInfo.id].y = playerInfo.y;
                otherPlayers[playerInfo.id].rotation = playerInfo.rotation;
            }
        });

        socket.on('playerDisconnected', (id) => {
            delete otherPlayers[id];
        });

        function drawShip(x, y, rotation, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.strokeStyle = color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(15, 0);
            ctx.lineTo(-10, 10);
            ctx.lineTo(-10, -10);
            ctx.closePath();
            ctx.stroke();
            ctx.restore();
        }

        function gameLoop() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let id in otherPlayers) {
                if (id !== socket.id) {
                    const p = otherPlayers[id];
                    drawShip(p.x, p.y, p.rotation, "#ff00ea");
                }
            }

            drawShip(myShip.x, myShip.y, myShip.rotation, myShip.color);
            requestAnimationFrame(gameLoop);
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === "ArrowLeft") myShip.rotation -= 0.1;
            if (e.key === "ArrowRight") myShip.rotation += 0.1;
            if (e.key === "ArrowUp") {
                myShip.x += Math.cos(myShip.rotation) * 5;
                myShip.y += Math.sin(myShip.rotation) * 5;
            }
            
            socket.emit('playerMovement', {
                x: myShip.x,
                y: myShip.y,
                rotation: myShip.rotation
            });
        });

        gameLoop();
    </script>
</body>
</html>