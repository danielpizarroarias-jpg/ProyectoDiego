<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Asteroids - Neon Life Up Edition</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; cursor: crosshair; user-select: none; }
        canvas { display: block; }
        
        /* UI INGAME */
        #ui-ingame {
            position: absolute; top: 20px; left: 20px; color: white; font-family: 'Courier New', monospace;
            pointer-events: none; z-index: 10; background: rgba(0, 0, 0, 0.85);
            padding: 15px; border: 1px solid #444; border-radius: 4px; min-width: 220px;
        }
        .ui-row { font-size: 16px; margin-bottom: 5px; display: flex; justify-content: space-between; }
        
        #lvl-txt { color: #00f2ff; text-shadow: 0 0 8px #00f2ff; font-weight: bold; }
        #lives-txt { color: #ff0077; text-shadow: 0 0 10px #ff0077; font-size: 20px; letter-spacing: 5px; }

        #bar-bg { width: 100%; height: 10px; background: #111; margin-top: 8px; border: 1px solid #333; border-radius: 5px; overflow: hidden; }
        #bar-fill { height: 100%; background: linear-gradient(90deg, #00ff88, #00ffcc); width: 0%; transition: width 0.4s ease-out; }
        
        .overlay {
            position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white; font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.95); z-index: 100; text-align: center;
        }

        /* PAUSA B&W */
        #pause-menu { 
            background: #000; z-index: 110; border: 4px solid #fff; 
            width: 320px; padding: 40px; left: 50%; top: 50%; 
            transform: translate(-50%, -50%); position: absolute;
        }
        #pause-menu h2 { font-size: 40px; margin-top: 0; letter-spacing: 8px; border-bottom: 2px solid #fff; padding-bottom: 10px; }

        button {
            background: #000; color: #fff; border: 2px solid #fff; padding: 12px 30px;
            font-size: 18px; cursor: pointer; font-weight: bold; margin-top: 20px; 
            text-transform: uppercase; width: 100%; font-family: 'Courier New', monospace;
        }
        button:hover { background: #fff; color: #000; }

        /* AVISO SUBIDA NIVEL */
        #level-up-container {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-family: 'Courier New', monospace; text-align: center;
            opacity: 0; transition: opacity 0.5s; pointer-events: none; z-index: 50;
        }
        #level-up-text { font-size: 60px; color: #00f2ff; text-shadow: 0 0 20px #00f2ff; margin: 0; }
        #life-up-text { font-size: 30px; color: #ff0077; text-shadow: 0 0 15px #ff0077; margin: 10px 0 0 0; font-weight: bold; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="ui-ingame" class="hidden">
        <div class="ui-row"><span>SECTOR:</span> <span id="lvl-txt">1</span></div>
        <div class="ui-row"><span>SCORE:</span> <span id="score-txt">0</span></div>
        <div class="ui-row"><span>META:</span> <span id="goal-txt">1000</span></div>
        <div id="bar-bg"><div id="bar-fill"></div></div>
        <div class="ui-row" style="margin-top:12px"><span>VIDAS:</span> <span id="lives-txt"></span></div>
    </div>

    <div id="level-up-container">
        <p id="level-up-text">SECTOR <span id="next-lvl-num"></span></p>
        <p id="life-up-text" class="hidden">+1 VIDA</p>
    </div>

    <div id="menu" class="overlay">
        <h1 id="title" style="font-size: 50px; letter-spacing: 10px; border: 4px solid #fff; padding: 20px;">ASTEROIDS</h1>
        <div id="stats" class="hidden">
            <p style="font-size: 20px; color: #ff0077;">SISTEMA COLAPSADO</p>
            <p>PUNTUACIÓN FINAL: <span id="final-score" style="color: #00ff88;">0</span></p>
        </div>
        <button style="width: 250px;" onclick="initGame()">INICIAR</button>
    </div>

    <div id="pause-menu" class="hidden">
        <h2>PAUSA</h2>
        <button onclick="togglePause()">CONTINUAR</button>
        <button onclick="goToMenu()">SALIR AL MENÚ</button>
    </div>

    <canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    const menu = document.getElementById('menu');
    const ui = document.getElementById('ui-ingame');
    const pauseMenu = document.getElementById('pause-menu');
    const levelUpContainer = document.getElementById('level-up-container');
    const lifeUpMsg = document.getElementById('life-up-text');
    
    let ship, asteroids, lasers, score, level, nextGoal, gameState, keys, mouse;
    let loopId = null;

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    keys = {};
    mouse = { x: 0, y: 0 };
    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', e => { if(e.button === 0 && gameState === 'PLAYING') shoot(); });
    
    window.addEventListener('keydown', e => { 
        keys[e.code] = true; 
        if(e.code === 'Space' && gameState === 'PLAYING') shoot();
        if(e.code === 'Escape') {
            if(gameState === 'PLAYING' || gameState === 'PAUSED') togglePause();
        }
    });
    window.addEventListener('keyup', e => keys[e.code] = false);

    function togglePause() {
        if(gameState === 'PLAYING') {
            gameState = 'PAUSED';
            pauseMenu.classList.remove('hidden');
        } else if(gameState === 'PAUSED') {
            gameState = 'PLAYING';
            pauseMenu.classList.add('hidden');
            run(); 
        }
    }

    function goToMenu() {
        gameState = 'DEAD';
        pauseMenu.classList.add('hidden');
        ui.classList.add('hidden');
        menu.classList.remove('hidden');
        document.getElementById('stats').classList.add('hidden');
        if(loopId) cancelAnimationFrame(loopId);
    }

    function initGame() {
        if(loopId) cancelAnimationFrame(loopId);
        gameState = 'PLAYING';
        score = 0; level = 1; nextGoal = 1000;
        asteroids = []; lasers = [];
        ship = { x: canvas.width / 2, y: canvas.height / 2, r: 12, angle: 0, velX: 0, velY: 0, blink: 120, lives: 3 };
        spawnAsteroids(5);
        menu.classList.add('hidden');
        pauseMenu.classList.add('hidden');
        ui.classList.remove('hidden');
        updateUI();
        run();
    }

    function spawnAsteroids(num) {
        for (let i = 0; i < num; i++) {
            let x, y;
            do {
                x = Math.random() * canvas.width;
                y = Math.random() * canvas.height;
            } while (Math.hypot(x - ship.x, y - ship.y) < 250);
            asteroids.push(new Asteroid(x, y, 45));
        }
    }

    function Asteroid(x, y, r) {
        this.x = x; this.y = y; this.r = r;
        let speed = (Math.random() * 1.2 + 0.4); 
        this.vx = (Math.random() - 0.5) * speed;
        this.vy = (Math.random() - 0.5) * speed;
        this.vert = Math.floor(Math.random() * 5 + 9);
        this.offsets = Array.from({length: this.vert}, () => Math.random() * 0.4 + 0.8);
    }

    function shoot() {
        if (lasers.length < 15) {
            lasers.push({ x: ship.x + Math.cos(ship.angle) * 15, y: ship.y + Math.sin(ship.angle) * 15, vx: Math.cos(ship.angle) * 12, vy: Math.sin(ship.angle) * 12 });
        }
    }

    function updateUI() {
        document.getElementById('lvl-txt').innerText = level;
        document.getElementById('score-txt').innerText = score;
        document.getElementById('goal-txt').innerText = nextGoal;
        document.getElementById('lives-txt').innerText = "▲ ".repeat(Math.max(0, ship.lives));
        let progress = (score / nextGoal) * 100;
        document.getElementById('bar-fill').style.width = Math.min(100, progress) + "%";
    }

    function gameOver() {
        gameState = 'DEAD';
        cancelAnimationFrame(loopId);
        document.getElementById('final-score').innerText = score;
        document.getElementById('stats').classList.remove('hidden');
        menu.classList.remove('hidden');
        ui.classList.add('hidden');
    }

    function run() {
        if (gameState !== 'PLAYING') return;
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ship.angle = Math.atan2(mouse.y - ship.y, mouse.x - ship.x);
        
        if (keys['KeyW'] || keys['ArrowUp']) {
            ship.velX += Math.cos(ship.angle) * 0.2;
            ship.velY += Math.sin(ship.angle) * 0.2;
        } else {
            ship.velX *= 0.98; ship.velY *= 0.98;
        }

        ship.x += ship.velX; ship.y += ship.velY;
        if (ship.x < 0) ship.x = canvas.width; else if (ship.x > canvas.width) ship.x = 0;
        if (ship.y < 0) ship.y = canvas.height; else if (ship.y > canvas.height) ship.y = 0;

        if (ship.blink === 0 || Math.floor(ship.blink / 10) % 2 === 0) {
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(ship.x + Math.cos(ship.angle) * 15, ship.y + Math.sin(ship.angle) * 15);
            ctx.lineTo(ship.x + Math.cos(ship.angle + 2.4) * 12, ship.y + Math.sin(ship.angle + 2.4) * 12);
            ctx.lineTo(ship.x + Math.cos(ship.angle - 2.4) * 12, ship.y + Math.sin(ship.angle - 2.4) * 12);
            ctx.closePath(); ctx.stroke();
        }
        if (ship.blink > 0) ship.blink--;

        for (let i = lasers.length - 1; i >= 0; i--) {
            let l = lasers[i];
            l.x += l.vx; l.y += l.vy;
            if (l.x < 0 || l.x > canvas.width || l.y < 0 || l.y > canvas.height) { lasers.splice(i, 1); continue; }
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(l.x, l.y, 2, 0, 7); ctx.fill();
        }

        for (let i = asteroids.length - 1; i >= 0; i--) {
            let a = asteroids[i];
            a.x += a.vx; a.y += a.vy;
            if (a.x < -a.r) a.x = canvas.width + a.r; else if (a.x > canvas.width + a.r) a.x = -a.r;
            if (a.y < -a.r) a.y = canvas.height + a.r; else if (a.y > canvas.height + a.r) a.y = -a.r;
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 1.5; ctx.beginPath();
            for(let j=0; j<a.vert; j++) {
                let ang = (j / a.vert) * Math.PI * 2;
                ctx.lineTo(a.x + Math.cos(ang) * a.r * a.offsets[j], a.y + Math.sin(ang) * a.r * a.offsets[j]);
            }
            ctx.closePath(); ctx.stroke();

            if (ship.blink === 0 && Math.hypot(ship.x - a.x, ship.y - a.y) < a.r + 7) {
                ship.lives--; updateUI();
                if (ship.lives <= 0) { gameOver(); return; }
                else { ship.x = canvas.width/2; ship.y = canvas.height/2; ship.velX = 0; ship.velY = 0; ship.blink = 120; }
            }

            for (let j = lasers.length - 1; j >= 0; j--) {
                let l = lasers[j];
                if (Math.hypot(l.x - a.x, l.y - a.y) < a.r) {
                    lasers.splice(j, 1); score += 100;
                    if (a.r > 15) { asteroids.push(new Asteroid(a.x, a.y, a.r / 2.2)); asteroids.push(new Asteroid(a.x, a.y, a.r / 2.2)); }
                    asteroids.splice(i, 1); updateUI();
                    if (score >= nextGoal) {
                        level++; nextGoal += 1000 + (level * 500); 
                        
                        // LOGICA VIDA EXTRA
                        let gainedLife = false;
                        if(ship.lives < 3) { ship.lives++; gainedLife = true; }
                        
                        document.getElementById('next-lvl-num').innerText = level;
                        if(gainedLife) lifeUpMsg.classList.remove('hidden');
                        else lifeUpMsg.classList.add('hidden');
                        
                        levelUpContainer.style.opacity = 1;
                        setTimeout(() => { levelUpContainer.style.opacity = 0; }, 2000);
                        
                        spawnAsteroids(3 + level); updateUI();
                    }
                    break;
                }
            }
        }
        loopId = requestAnimationFrame(run);
    }
</script>
</body>
</html>