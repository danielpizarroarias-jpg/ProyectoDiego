<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Asteroids Progresivo</title>
    <style>
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden; background-color: black;
            cursor: crosshair; user-select: none;
        }
        canvas { display: block; }
        
        #ui-ingame {
            position: absolute; top: 20px; left: 20px;
            color: white; font-family: 'Courier New', Courier, monospace;
            pointer-events: none; z-index: 10;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px; border-radius: 8px;
            border: 1px solid #333; min-width: 200px;
        }
        .ui-row { font-size: 18px; letter-spacing: 1px; margin-bottom: 8px; text-transform: uppercase; }
        .ui-value { color: #00ff00; font-weight: bold; }
        
        #goal-container { width: 100%; height: 6px; background: #333; margin-top: 5px; border-radius: 3px; overflow: hidden; }
        #goal-bar { height: 100%; background: #00ff00; width: 0%; transition: width 0.3s; box-shadow: 0 0 10px #00ff00; }

        #level-indicator {
            position: absolute; top: 40%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Courier New', Courier, monospace;
            font-size: 80px; color: rgba(0, 255, 255, 0.9);
            pointer-events: none; text-shadow: 0 0 30px cyan;
            transition: opacity 0.5s; opacity: 0; z-index: 15; text-align: center;
        }
        #level-subtext { font-size: 24px; color: white; display: block; margin-top: 10px; text-shadow: none; }

        .overlay-menu {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: white; font-family: 'Courier New', Courier, monospace;
            text-align: center; z-index: 20; background: rgba(0,0,0,0.9);
        }
        h1 { font-size: 60px; margin: 0; letter-spacing: 10px; text-shadow: 0 0 20px white; }
        button {
            background: transparent; color: white; border: 2px solid white;
            padding: 15px 30px; cursor: pointer; font-family: inherit;
            font-size: 20px; margin-top: 25px; transition: 0.2s; text-transform: uppercase;
        }
        button:hover { background: white; color: black; box-shadow: 0 0 15px white; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="ui-ingame" class="hidden">
        <div class="ui-row">NIVEL: <span id="level-display" class="ui-value" style="color:cyan">1</span></div>
        <div class="ui-row">Puntos: <span id="current-score" class="ui-value">0</span></div>
        <div class="ui-row">Meta: <span id="score-goal" class="ui-value" style="color:yellow">800</span></div>
        <div id="goal-container"><div id="goal-bar"></div></div>
        <div class="ui-row" style="margin-top:15px">Vidas: <span id="lives-icons" class="ui-value" style="color: #ff0055"></span></div>
    </div>

    <div id="level-indicator">
        NIVEL <span id="lvl-num">1</span>
        <span id="level-subtext">INICIANDO...</span>
    </div>

    <div id="menu-overlay" class="overlay-menu">
        <h1 id="menu-title">ASTEROIDS</h1>
        <div id="stats-box">
            <p id="final-stats" class="hidden" style="font-size: 20px; color: #aaa;">
                Nivel alcanzado: <span id="final-level" style="color:cyan">1</span><br>
                Puntuación final: <span id="last-score" style="color:#00ff00">0</span>
            </p>
        </div>
        <button onclick="startGame()">INICIAR MISIÓN</button>
        <p style="margin-top: 30px; font-size: 14px; opacity: 0.6;">
            W-A-S-D: Movimiento | CLIC / ESPACIO: Disparar
        </p>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // UI Elements
    const menuOverlay = document.getElementById('menu-overlay');
    const uiInGame = document.getElementById('ui-ingame');
    const scoreEl = document.getElementById('current-score');
    const goalEl = document.getElementById('score-goal');
    const goalBar = document.getElementById('goal-bar');
    const livesEl = document.getElementById('lives-icons');
    const levelDisplay = document.getElementById('level-display');
    const levelIndicator = document.getElementById('level-indicator');
    const lvlNum = document.getElementById('lvl-num');
    const levelSubtext = document.getElementById('level-subtext');
    const lastScoreEl = document.getElementById('last-score');
    const finalLevelEl = document.getElementById('final-level');
    const finalStats = document.getElementById('final-stats');
    const menuTitle = document.getElementById('menu-title');

    // Variables
    let score = 0, level = 1, currentGoal = 800;
    let gameState = 'MENU';
    let asteroids = [], lasers = [], keys = {}, ship;

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function startGame() {
        gameState = 'PLAYING';
        score = 0; level = 1; currentGoal = 800;
        lasers = []; asteroids = [];
        spawnShip();
        updateUI();
        spawnAsteroids(3, 0.5); 
        showLevelMessage(1, "SISTEMAS ONLINE");
        menuOverlay.classList.add('hidden');
        uiInGame.classList.remove('hidden');
    }

    function spawnShip() {
        ship = {
            x: canvas.width / 2, y: canvas.height / 2,
            r: 12, a: -Math.PI / 2,
            thrust: { x: 0, y: 0 }, rot: 0,
            lives: 3, blinkTime: 120, thrusting: false
        };
    }

    function spawnAsteroids(count, speedMult) {
        for (let i = 0; i < count; i++) {
            let x, y;
            do {
                x = Math.random() * canvas.width;
                y = Math.random() * canvas.height;
            } while (Math.hypot(ship.x - x, ship.y - y) < 200);
            asteroids.push(new Asteroid(x, y, 45, speedMult));
        }
    }

    function Asteroid(x, y, r, speedMult) {
        this.x = x; this.y = y; this.r = r;
        this.speedMult = speedMult;
        let baseSpeed = (40 / r);
        this.xv = (Math.random() - 0.5) * baseSpeed * speedMult;
        this.yv = (Math.random() - 0.5) * baseSpeed * speedMult;
        this.a = Math.random() * Math.PI * 2;
        this.vert = Math.floor(Math.random() * 5 + 7);
        this.offset = Array.from({length: this.vert}, () => Math.random() * 0.4 + 0.8);
    }

    function nextLevel() {
        level++;
        currentGoal = score + (level * 1000);
        if (ship.lives < 5) ship.lives++; 
        
        let msg = "VELOCIDAD AUMENTADA";
        if (level === 2) msg = "¡DISPARO DOBLE ACTIVADO!";
        if (level === 4) msg = "¡DISPARO TRIPLE ACTIVADO!";
        
        asteroids = []; lasers = [];
        spawnAsteroids(3 + level, 0.5 + (level * 0.15));
        showLevelMessage(level, msg);
        
        let oldLives = ship.lives;
        spawnShip();
        ship.lives = oldLives;
        updateUI();
    }

    function showLevelMessage(lvl, txt) {
        lvlNum.innerText = lvl;
        levelSubtext.innerText = txt;
        levelIndicator.style.opacity = "1";
        setTimeout(() => { levelIndicator.style.opacity = "0"; }, 2000);
    }

    function updateUI() {
        levelDisplay.innerText = level;
        scoreEl.innerText = score;
        goalEl.innerText = currentGoal;
        livesEl.innerText = "▲ ".repeat(Math.max(0, ship.lives));
        goalBar.style.width = Math.min(100, (score / currentGoal) * 100) + "%";
    }

    function gameOver() {
        gameState = 'MENU';
        menuTitle.innerText = "MISIÓN FALLIDA";
        lastScoreEl.innerText = score;
        finalLevelEl.innerText = level;
        finalStats.classList.remove('hidden');
        menuOverlay.classList.remove('hidden');
        uiInGame.classList.add('hidden');
    }

    window.addEventListener("keydown", e => keys[e.code] = true);
    window.addEventListener("keyup", e => keys[e.code] = false);
    window.addEventListener("mousedown", () => { if(gameState==='PLAYING') shoot(); });
    window.addEventListener("keydown", e => { if(e.code==='Space' && gameState==='PLAYING') shoot(); });

    function shoot() {
        if (lasers.length > 25) return;
        const addL = (ang, ox=0, oy=0) => {
            lasers.push({
                x: ship.x + 4/3 * ship.r * Math.cos(ship.a) + ox,
                y: ship.y - 4/3 * ship.r * Math.sin(ship.a) + oy,
                xv: 10 * Math.cos(ship.a + ang), yv: -10 * Math.sin(ship.a + ang), dist: 0
            });
        };

        if (level < 2) addL(0);
        else if (level < 4) { addL(0, 5, 5); addL(0, -5, -5); }
        else { addL(0); addL(0.2); addL(-0.2); }
    }

    function update() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (gameState === 'PLAYING') {
            ship.rot = (keys["KeyA"] || keys["ArrowLeft"]) ? 0.08 : (keys["KeyD"] || keys["ArrowRight"]) ? -0.08 : 0;
            if (keys["KeyW"] || keys["ArrowUp"]) {
                ship.thrust.x += 0.07 * Math.cos(ship.a);
                ship.thrust.y -= 0.07 * Math.sin(ship.a);
                ship.thrusting = true;
            } else {
                ship.thrust.x *= 0.93; ship.thrust.y *= 0.93;
                ship.thrusting = false;
            }
            ship.a += ship.rot; ship.x += ship.thrust.x; ship.y += ship.thrust.y;

            if (ship.x < -ship.r) ship.x = canvas.width + ship.r; else if (ship.x > canvas.width + ship.r) ship.x = -ship.r;
            if (ship.y < -ship.r) ship.y = canvas.height + ship.r; else if (ship.y > canvas.height + ship.r) ship.y = -ship.r;

            if (ship.blinkTime === 0 || Math.floor(ship.blinkTime / 10) % 2 === 0) {
                ctx.strokeStyle = level >= 4 ? "cyan" : "white";
                ctx.lineWidth = 2; ctx.beginPath();
                ctx.moveTo(ship.x + 4/3 * ship.r * Math.cos(ship.a), ship.y - 4/3 * ship.r * Math.sin(ship.a));
                ctx.lineTo(ship.x - ship.r * (2/3 * Math.cos(ship.a) + Math.sin(ship.a)), ship.y + ship.r * (2/3 * Math.sin(ship.a) - Math.cos(ship.a)));
                ctx.lineTo(ship.x - ship.r * (2/3 * Math.cos(ship.a) - Math.sin(ship.a)), ship.y + ship.r * (2/3 * Math.sin(ship.a) + Math.cos(ship.a)));
                ctx.closePath(); ctx.stroke();
            }
            if (ship.blinkTime > 0) ship.blinkTime--;

            for (let i = lasers.length - 1; i >= 0; i--) {
                let l = lasers[i];
                l.x += l.xv; l.y += l.yv; l.dist += 10;
                if (l.x < 0) l.x = canvas.width; else if (l.x > canvas.width) l.x = 0;
                if (l.y < 0) l.y = canvas.height; else if (l.y > canvas.height) l.y = 0;
                ctx.fillStyle = level >= 2 ? "cyan" : "yellow";
                ctx.beginPath(); ctx.arc(l.x, l.y, 3, 0, Math.PI*2); ctx.fill();
                if (l.dist > canvas.width * 0.7) lasers.splice(i, 1);
            }
        }

        for (let i = asteroids.length - 1; i >= 0; i--) {
            let a = asteroids[i];
            a.x += a.xv; a.y += a.yv;
            if (a.x < -a.r) a.x = canvas.width + a.r; else if (a.x > canvas.width + a.r) a.x = -a.r;
            if (a.y < -a.r) a.y = canvas.height + a.r; else if (a.y > canvas.height + a.r) a.y = -a.r;

            ctx.strokeStyle = "white"; ctx.beginPath();
            ctx.moveTo(a.x + a.r * a.offset[0] * Math.cos(a.a), a.y + a.r * a.offset[0] * Math.sin(a.a));
            for (let j = 1; j < a.vert; j++) {
                ctx.lineTo(a.x + a.r * a.offset[j] * Math.cos(a.a + j * Math.PI * 2 / a.vert), 
                           a.y + a.r * a.offset[j] * Math.sin(a.a + j * Math.PI * 2 / a.vert));
            }
            ctx.closePath(); ctx.stroke();

            if (gameState === 'PLAYING') {
                for (let j = lasers.length - 1; j >= 0; j--) {
                    if (Math.hypot(lasers[j].x - a.x, lasers[j].y - a.y) < a.r) {
                        lasers.splice(j, 1);
                        score += a.r > 30 ? 50 : a.r > 15 ? 100 : 200;
                        updateUI();
                        if (score >= currentGoal) { nextLevel(); return; }
                        if (a.r > 15) {
                            asteroids.push(new Asteroid(a.x, a.y, a.r / 2, a.speedMult * 1.2));
                            asteroids.push(new Asteroid(a.x, a.y, a.r / 2, a.speedMult * 1.2));
                        }
                        asteroids.splice(i, 1); break;
                    }
                }
                if (ship.blinkTime === 0 && Math.hypot(ship.x - a.x, ship.y - a.y) < ship.r + a.r) {
                    ship.lives--; updateUI();
                    if (ship.lives <= 0) gameOver();
                    else { let l = ship.lives; spawnShip(); ship.lives = l; }
                }
            }
        }
        if (gameState === 'PLAYING' && asteroids.length === 0) spawnAsteroids(2, 0.7);

        requestAnimationFrame(update);
    }
    
    // Iniciar bucle
    update();
</script>
</body>
</html>